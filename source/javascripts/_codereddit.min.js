$(function(){var a=grabHash(window.location.hash);posts=renderPost(a);$("body").delegate(".expander","click",function(){$(this).parents("ul").first().find(".comments").is(":empty")?getComments($(this).attr("id"),$(this).parents("ul").first().find(".comments")):$(this).parents("ul").first().find(".comments").show();$(this).attr("src","img/collapse.png");$(this).addClass("collapse");$(this).removeClass("expander")});$("body").delegate(".collapse","click",function(){$(this).parents("ul").first().find(".comments").hide();
$(this).attr("src","img/expand.png");$(this).addClass("expander");$(this).removeClass("collapse")});$(window).bind("hashchange",function(a){a=a.fragment;$("body").html("");renderPost(a)})});
function renderPost(a){a=""!=a?"http://www.reddit.com/r/"+a+"/.json?jsonp=?":"http://www.reddit.com/.json?jsonp=?";return $.getJSON(a,function(e){var c;a=window.location.hash;c="<pre class='php'>\nrequire('<a href='readme.html'>readme.php</a>');\nsession_start();</pre>";c=a?c+("<pre class='php'>$subreddit = $_GET[\""+a+'"];</pre>'):c+"<pre class='php'>$subreddit = $_GET[\"frontpage\"];</pre>";$("body").append(c);$.get("php.html",function(a){$.each(e.data.children,function(c){var b=a,d=e.data.children[c].data,
c=createTitle(d,c),b=b.replace("${title}",c),b=d.selftext?b.replace("${selftext}",formatCommentText(d.selftext,"    ")):b.replace("${selftext}",""),b=/\.(jpg)|(gif)|(png)$/.test(d.url)?b.replace("${fancybox}","image"):/www.youtube.com/.test(d.url)?b.replace("${fancybox}","video"):b.replace("${fancybox}",""),b=b.replace("${subreddit}",d.subreddit),b=b.replace("${suburl}","#"+d.subreddit),b=b.replace("${url}",d.url),b=b.replace("${author}",d.author),b=b.replace("${score}",d.score),b=b.replace("${domain}",
d.domain),b=b.replace("${fulltitle}",d.title),b=b.replace("${num_comments}",d.num_comments),b=b.replace("${entry_id}",d.name);$("body").append(b);$("pre.php").snippet("php",{style:"emacs",showNum:!1,transparent:!0,menu:!1});$("a.image").fancybox({transitionIn:"elastic",transitionOut:"elastic",speedIn:600,speedOut:200})})})})}
function createTitle(a){a=a.title.toLowerCase().substring(0,20).replace(/[^A-Za-z0-9\s\s+]/gi,"").split(" ");for(token in a)a[token]=a[token].charAt(0).toUpperCase()+a[token].slice(1);return a=a.join("")}function grabHash(a){return a.replace("#","")}
function getComments(a,e){var c="",f="http://www.reddit.com/comments/"+a.replace("t3_","")+".json?jsonp=?";$.getJSON(f,function(a){a=a[1].data.children.slice(0,20);$.each(a,function(b){template='\t$author = "${commenter}";\n$score = ${score};\n${text} \n\n\n';template=template.replace("${commenter}",a[b].data.author);template=template.replace("${score}",a[b].data.ups-a[b].data.downs);template=template.replace("${text}",formatCommentText(a[b].data.body,"    "));c+=template});e.text(c);e.snippet("php",
{style:"emacs",showNum:!1,transparent:!0,menu:!1})});return c}function formatCommentText(a,e){var a=a.replace(/(\r\n|\n|\r)/gm,""),c="";num_splits=Math.floor(a.length/80);for(i=0;i<=num_splits;)c=c+"// "+a.substring(80*i,80*(i+1))+"\n"+e,i++;return c};